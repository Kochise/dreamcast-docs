<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><TITLE>DLL and Setup Functions</TITLE>
<STYLE>
<!--
.tctop {color: blue}
.cpslug {color: blue; text-decoration: none}
-->
</STYLE>
<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
function ShowButtons() {
    if (window.top.frames.length!=0 && window.top.frames[0].ShowButtons!=null)
	window.top.frames[0].ShowButtons('/dssd0261.htm','/dssd0000.htm','/dssd0256.htm','/index.htm','/dssd0263.htm');
}
ShowButtons();
//-->
</SCRIPT>
</HEAD>
<BODY onLoad="ShowButtons()" TOPMARGIN=10 BGPROPERTIES="FIXED" BGCOLOR="#FFFFFF" LINK="#000000" VLINK="#808080" ALINK="#000000">
<FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="fmutil_0001060306000000">DLL and Setup Functions</A></H2>
<BR CLEAR=ALL>
<P>The Combase.h header file provides the following function for creating a run-time dynamic link with a specific dynamic-link library (DLL). For more information, read the <I>Run-Time Dynamic Linking</I> section in the Platform SDK. 

<TABLE BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Function </B></FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Description
</B></FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0262.htm#fmutil_0001060306000100" TARGET="TEXT">LoadOLEAut32</A>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Loads the Automation DLL (OleAut32.dll).
</FONT></TD></TR></TABLE>
<P>The Dllsetup.h header file provides the following functions for registering and unregistering DirectShow filters. You'll typically call <A HREF="dssd0262.htm#fmutil_0001060306000300" TARGET="TEXT">AMovieDllRegisterServer2</A> to register your filter. The other functions are either helper functions or provide backwards compatibility.

<TABLE BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Function </B></FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Description
</B></FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0262.htm#fmutil_0001060306000200" TARGET="TEXT">AMovieDllRegisterServer</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Registers filters. ActiveMovie 1.0 only.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0262.htm#fmutil_0001060306000300" TARGET="TEXT">AMovieDllRegisterServer2</A>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Registers and unregisters filters.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0262.htm#fmutil_0001060306000400" TARGET="TEXT">AMovieDllUnregisterServer</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Unregisters filters. ActiveMovie 1.0 only.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0262.htm#fmutil_0001060306000500" TARGET="TEXT">AMovieSetupRegisterFilter</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Registers a filter's merit, pins, and media types in the registry using the filter mapper. ActiveMovie 1.0 only.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0262.htm#fmutil_0001060306000600" TARGET="TEXT">AMovieSetupRegisterFilter2</A> 

 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Registers a filter's merit, pins, and media types in the registry using <B>IFilterMapper2</B>.
</FONT></TD></TR></TABLE>
<H3><HR COLOR=#0000FF><A NAME="fmutil_0001060306000100">LoadOLEAut32</A></H3>
<P>Loads the Automation dynamic-link library (OleAut32.dll).
<P><B>HINSTANCE</B> <B>LoadOLEAut32</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>Returns a handle to an Automation DLL instance.

<H5>Remarks</H5>
<P>When the <A HREF="dssd0198.htm" TARGET="TEXT">CBaseObject</A> destructor destroys the object that loaded OleAut32.dll, it will unload the library if it is still loaded.
<H3><HR COLOR=#0000FF><A NAME="fmutil_0001060306000200">AMovieDllRegisterServer</A></H3>
<P>Registers filters. ActiveMovie 1.0 only.
<P><B>HRESULT</B> <B>AMovieDllRegisterServer</B><B>(</B><B>void</B><B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>Returns an <A HREF="dssd0293.htm#errcodes_0001060a01000001" TARGET="TEXT">HRESULT</A> value.

<H5>Remarks</H5>
<P>Use <A HREF="dssd0262.htm#fmutil_0001060306000300" TARGET="TEXT">AMovieDllRegisterServer2</A> rather than this function to set up (register) your filters unless you need compatibility with ActiveMovie 1.0 filters. See <A HREF="dssd0053.htm" TARGET="TEXT">Register DirectShow Objects</A> and the sample filters included with the DirectShow SDK for more information about <B>AMovieDllRegisterServer2</B>. 
<H3><HR COLOR=#0000FF><A NAME="fmutil_0001060306000300">AMovieDllRegisterServer2</A></H3>
<P>Registers and unregisters filters.
<P><B>HRESULT</B> <B>AMovieDllRegisterServer2</B><B>(</B><BR>&nbsp;&nbsp;<B>BOOL</B> <I>bRegister</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>bRegister</I>
 </DT><DD>TRUE indicates register the filter, FALSE indicates unregister it.
</DD></DL>
<H5>Return Values</H5>
<P>Returns an <A HREF="dssd0293.htm#errcodes_0001060a01000001" TARGET="TEXT">HRESULT</A> value.



<H5>Remarks</H5>
<P>Use this function to set up your filters. See <A HREF="dssd0053.htm" TARGET="TEXT">Register DirectShow Objects</A> and the sample filters included with the DirectShow SDK for more information. 



<P><P><B>Note:</B>  The filter registration process is changing to allow filters to register by category. For example, capture filters and compression filters are enumerated together in their respective categories. The following functions demonstrate how filter registration and unregistration by category might work. The <A HREF="dssd0353.htm#samples_0001070207020000" TARGET="TEXT">AMCap</A> sample demonstrates this procedure. The following function uses the <B>IFilterMapper2</B> interface, which is not yet documented for this beta release. <PRE><FONT FACE="Courier" SIZE="2">
// Register Sample Compressor Filter
STDAPI
DllRegisterServer( void )
{
 HRESULT hr = AMovieDllRegisterServer2( TRUE );
 if( FAILED(hr) )
     return hr;

 const WCHAR *wszUniq = L"Sample Compressor Filter" ;

 IFilterMapper2 *pFm2 = 0;

 hr = CoCreateInstance( CLSID_FilterMapper2
                         , NULL
                         , CLSCTX_INPROC_SERVER
                         , IID_IFilterMapper2
                         , (void **)&amp;pFm2       );
    
 if(FAILED(hr))
     return hr;

 hr = pFm2-&gt;RegisterFilter(
      CLSID_SampleCompressorFilter,
      wszUniq,
      0,
      &amp;CLSID_VideoCompressorCategory,
      wszUniq,
      MERIT_DO_NOT_USE,
      NULL,
      0);

 pFm2-&gt;Release();
 
 return hr;
}

// Unregister Sample Compressor Filter
STDAPI
DllUnregisterServer( void )
{

HRESULT hr = AMovieDllRegisterServer2( FALSE );
if( FAILED(hr) )
    return hr;

const WCHAR *wszUniq = L"Sample Compressor Filter" ;

IFilterMapper2 *pFm2 = 0;

hr = CoCreateInstance( CLSID_FilterMapper2
                        , NULL
                        , CLSCTX_INPROC_SERVER
                        , IID_IFilterMapper2
                        , (void **)&amp;pFm2       );
    
if(FAILED(hr))
    return hr;

hr = pFm2-&gt;UnregisterFilter(
     &amp;CLSID_VideoCompressorCategory,
     wszUniq,
     CLSID_SampleCompressorFilter);

pFm2-&gt;Release();
 
return hr;
}
</FONT></PRE>
<H3><HR COLOR=#0000FF><A NAME="fmutil_0001060306000400">AMovieDllUnregisterServer</A></H3>
<P>Unregisters filters. ActiveMovie 1.0 only.
<P><B>HRESULT</B> <B>AMovieDllUnregisterServer</B><B>(</B><B>void</B><B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>Returns an <A HREF="dssd0293.htm#errcodes_0001060a01000001" TARGET="TEXT">HRESULT</A> value.

<H5>Remarks</H5>
<P>Use <A HREF="dssd0262.htm#fmutil_0001060306000300" TARGET="TEXT">AMovieDllRegisterServer2</A> rather than this function to uninstall (unregister) your filters unless you need compatibility with ActiveMovie 1.0 filters. See <A HREF="dssd0053.htm" TARGET="TEXT">Register DirectShow Objects</A> and the sample filters included with the DirectShow SDK for more information about <B>AMovieDllRegisterServer2</B>. 
<H3><HR COLOR=#0000FF><A NAME="fmutil_0001060306000500">AMovieSetupRegisterFilter</A></H3>
<P>Registers a filter's merit, pins, and media types in the registry using the filter mapper. ActiveMovie 1.0 only.
<P><B>HRESULT</B> <B>AMovieSetupRegisterFilter</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>AMOVIESETUP_FILTER</B> <B>*const</B> <I>psetupdata</I><B>,</B><BR>&nbsp;&nbsp;<B>IFilterMapper</B> <I>*pIFM</I><B>,</B><BR>&nbsp;&nbsp;<B>BOOL</B> <I>bRegister</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>psetupdata</I>
 </DT><DD>Pointer to the <A HREF="dssd0287.htm#structs_0001060501000500" TARGET="TEXT">AMOVIESETUP_FILTER</A> data.
</DD><DT><I>pIFM</I>
 </DT><DD>Pointer to <A HREF="dssd0143.htm" TARGET="TEXT">IFilterMapper</A> interface.
</DD><DT><I>bRegister</I>
 </DT><DD>TRUE indicates register the filter, FALSE indicates unregister it.
</DD></DL>
<H5>Return Values</H5>
<P>Returns an <A HREF="dssd0293.htm#errcodes_0001060a01000001" TARGET="TEXT">HRESULT</A> value.

<H5>Remarks</H5>
<P>The <A HREF="dssd0194.htm" TARGET="TEXT">CBaseFilter</A> base class uses this helper function to register a filter if the 1.0 ActiveMovie runtime is installed. It is provided for compatibility with ActiveMovie version 1.0 only. 

<P>Typically a filter will use <A HREF="dssd0262.htm#fmutil_0001060306000200" TARGET="TEXT">AMovieDllRegisterServer</A> and will not call this function directly.
<H3><HR COLOR=#0000FF><A NAME="fmutil_0001060306000600">AMovieSetupRegisterFilter2</A></H3>
<P>Registers a filter's merit, pins, and media types in the registry using <B>IFilterMapper2</B>.
<P><B>HRESULT</B> <B>AMovieSetupRegisterFilter2</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>AMOVIESETUP_FILTER</B> <B>*const</B> <I>psetupdata</I><B>,</B><BR>&nbsp;&nbsp;<B>IFilterMapper2</B> <I>*pIFM2</I><B>,</B><BR>&nbsp;&nbsp;<B>BOOL</B> <I>bRegister</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>psetupdata</I>
 </DT><DD>Pointer to the <A HREF="dssd0287.htm#structs_0001060501000500" TARGET="TEXT">AMOVIESETUP_FILTER</A> data.
</DD><DT><I>pIFM</I>
 </DT><DD>Pointer to <B>IFilterMapper2</B> interface.
</DD><DT><I>bRegister</I>
 </DT><DD>TRUE indicates register the filter, FALSE indicates unregister it.
</DD></DL>
<H5>Return Values</H5>
<P>Returns an <A HREF="dssd0293.htm#errcodes_0001060a01000001" TARGET="TEXT">HRESULT</A> value.

<H5>Remarks</H5>
<P><A HREF="dssd0262.htm#fmutil_0001060306000300" TARGET="TEXT">AMovieDllRegisterServer2</A> uses this helper function to register a filter after the OLE server has been registered.

<P>Typically a filter will use <A HREF="dssd0262.htm#fmutil_0001060306000300" TARGET="TEXT">AMovieDllRegisterServer2</A> and will not call this function directly.
<P><P><FONT FACE="MS SANS SERIF" SIZE="1" COLOR="BLACK">
<A CLASS=cpslug HREF="copyrite.htm" TARGET="TEXT">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A>
</FONT>
<BR CLEAR=ALL><P>
</FONT><P>
</BODY></HTML>
